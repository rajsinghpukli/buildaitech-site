<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RegulAIte — Regulatory Assistant</title>
<style>
  body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#f5f7fb; color:#1f2937; margin:0; }
  .container { max-width: 980px; margin: 32px auto 120px; padding: 0 16px; }
  .hero { background: linear-gradient(135deg,#1d6fb7,#2a8bd8); color:#fff; border-radius:18px; padding:18px 20px; box-shadow:0 18px 40px rgba(16,84,150,.22); }
  .card { background:#fff; border-radius:14px; box-shadow:0 10px 24px rgba(0,0,0,.06); border:1px solid rgba(37,99,235,.18); padding:14px 16px; margin-top:14px; }
  .askbar { display:flex; gap:8px; margin-top:8px; }
  textarea { width:100%; height:120px; border-radius:12px; border:1px solid #d0d7e2; padding:10px; font-size:16px; }
  button { border:0; background:linear-gradient(135deg,#1d6fb7,#2a8bd8); color:#fff; border-radius:999px; padding:10px 18px; font-weight:700; cursor:pointer; }
  .answer { padding:16px; }
  .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:8px; }
  .chip { background:linear-gradient(180deg,#f1f8ff,#fff); border:1px solid rgba(37,99,235,.18); padding:8px 10px; border-radius:12px; cursor:pointer; font-weight:600; }
  .small { opacity:.8; font-size:13px; }
  .answer h2 { font-size:1.28rem; border-left:6px solid #2a8bd8; padding-left:10px; background:linear-gradient(90deg,rgba(14,165,233,.10),transparent); border-radius:8px; }
  .answer table { border-collapse: collapse; width:100%; }
  .answer table, .answer th, .answer td { border:1px solid #e5e7eb; }
  .answer th, .answer td { padding:8px; text-align:left; }
</style>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="hero">
      <h1 style="margin:0">RegulAIte — Regulatory Assistant</h1>
      <div class="small">IFRS • AAOIFI • CBB • Internal Policies</div>
    </div>

    <div class="card">
      <div>Ask anything</div>
      <div class="askbar">
        <textarea id="q" placeholder="e.g., Compare ECL staging for debt-type sukuk (IFRS 9 vs AAOIFI) with table and citations."></textarea>
      </div>
      <div style="display:flex; gap:8px; align-items:center; margin-top:8px;">
        <label><input type="checkbox" id="web" checked /> Include web sources</label>
        <label style="margin-left:8px;"><input type="radio" name="depth" value="standard" checked> Standard</label>
        <label><input type="radio" name="depth" value="deep"> Deep</label>
        <label><input type="radio" name="depth" value="concise"> Concise</label>
        <button id="ask">Ask</button>
      </div>
    </div>

    <div id="results"></div>
  </div>

<script>
const API_BASE = "https://api.buildaitech.com"; // we'll make this live in step 2F
const results = document.getElementById("results");

async function callAPI(query, includeWeb, depth) {
  const payload = { q: query, include_web: includeWeb, depth };
  const r = await fetch(`${API_BASE}/api/ask`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });
  if (!r.ok) throw new Error(`API ${r.status}`);
  return await r.json();
}

function extractFollowups(md) {
  const out = [];
  (md || "").split(/\r?\n/).forEach(line => {
    const m = line.match(/^\s*-\s*\[Ask\]\s*(.+?)\s*$/i);
    if (m && m[1] && out.length < 8) out.push(m[1]);
  });
  return out;
}

function showAnswer(question, md) {
  const div = document.createElement("div");
  div.className = "card";
  const chips = extractFollowups(md);
  div.innerHTML = `
    <div><strong>❓ ${question}</strong></div>
    <div class="answer">${marked.parse(md || "_No answer returned._")}</div>
    ${chips.length ? `<div class="chips">${chips.map(c => `<span class="chip" data-q="${c.replace(/"/g,"&quot;")}">${c}</span>`).join("")}</div>` : ""}
    <div class="small" style="margin-top:6px">click a follow-up to auto-ask</div>
  `;
  document.getElementById("results").appendChild(div);
  div.querySelectorAll(".chip").forEach(el => {
    el.addEventListener("click", () => {
      document.getElementById("q").value = el.dataset.q;
      document.getElementById("ask").click();
    });
  });
}

document.getElementById("ask").addEventListener("click", async () => {
  const q = document.getElementById("q").value.trim();
  if (!q) return;
  const includeWeb = document.getElementById("web").checked;
  const depth = document.querySelector('input[name="depth"]:checked').value;

  const card = document.createElement("div");
  card.className = "card";
  card.textContent = "Thinking…";
  results.appendChild(card);

  try {
    const res = await callAPI(q, includeWeb, depth);
    results.removeChild(card);
    showAnswer(q, res.answer_markdown || res.answer || "");
  } catch (e) {
    results.removeChild(card);
    const err = document.createElement("div");
    err.className = "card";
    err.textContent = `Error: ${e.message}`;
    results.appendChild(err);
  }
});
</script>
</body>
</html>
